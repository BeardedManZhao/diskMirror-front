class DiskMirror{constructor(url){this.diskMirrorUrl=url;this.setSk();this.setController('/FsCrud')}xorEncrypt(value){let encrypted=value;const sk_str=this.sk.toString();for(let i=0;i<sk_str.length;i++){encrypted-=sk_str.charCodeAt(i)<<1}return encrypted}setController(controllerName){this.controller=controllerName}getController(){return this.controller}setSk(key=0,domain=undefined){this.sk=key;if(key!==0){this.setDiskMirrorXorSecureKey(domain)}}getSk(){return this.sk}upload(params,file,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(file instanceof String){this.upload(params,new File([new Blob([file])],params['fileName']),okFun,errorFun,checkFun);return}if(checkFun!==undefined&&!checkFun(params,file)){return}const formData=new FormData();params["secure.key"]=this.getSk();formData.append('params',JSON.stringify(params));formData.append('file',file);axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/add',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}getUrls(userId,type,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined,){if(userId===undefined||type===undefined||type===''){const err="您必须要输入 userId 以及 type 参数才可以进行 url 的获取";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}const formData=new FormData();const params={userId:userId,type:type,"secure.key":this.getSk()};if(checkFun!==undefined&&!checkFun(params)){return}formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/getUrls',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}remove(userId,type,fileName,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined,){if(userId===undefined||type==null||type===''||fileName===undefined||fileName===''){const err="您必须要输入 userId 以及 type 和 fileName 参数才可以进行删除";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}const formData=new FormData();const params={fileName:fileName,userId:userId,type:type,"secure.key":this.getSk()};if(checkFun!==undefined&&!checkFun(params)){return}formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/remove',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}reName(userId,type,fileName,newName,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(userId===undefined||type==null||type===''||fileName===undefined||fileName===''||newName===undefined||newName===''){const err="您必须要输入 userId 和 type 以及 fileName 和 newName 参数才可以进行重命名";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}const formData=new FormData();const params={fileName:fileName,newName:newName,userId:userId,type:type,"secure.key":this.getSk()};if(checkFun!==undefined&&!checkFun(params)){return}formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/reName',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}mkdirs(userId,type,fileName,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(userId===undefined||type==null||type===''||fileName===undefined||fileName===''){const err="您必须要输入 userId 和 type 以及 fileName 参数才可以进行文件目录的创建";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}const formData=new FormData();const params={fileName:fileName,userId:userId,type:type,"secure.key":this.getSk()};if(checkFun!==undefined&&!checkFun(params)){return}formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/mkdirs',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}downLoad(userId,type,fileName,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(userId===undefined||type==null||type===''||fileName===undefined||fileName===''||okFun===undefined){const err="您必须要输入 userId 和 type 以及 fileName 和 okFun 参数才可以进行文件对象的获取！";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}if(checkFun!==undefined&&!checkFun({userId:userId,type:type,fileName:fileName})){return}okFun(this.diskMirrorUrl+this.getController()+`/downLoad/${userId}/${type}?fileName=${fileName}`)}transferDeposit(params,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(checkFun!==undefined&&!checkFun(params)){return}const formData=new FormData();params["secure.key"]=this.getSk();formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/transferDeposit',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(res.data['res']!=='ok!!!!'){if(errorFun!==undefined){errorFun(res.data)}return}if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}getAllProgressBar(userId,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(userId===undefined||okFun===undefined){const err="您必须要输入 userId 和 okFun 参数才可以进行文件对象的获取！";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}if(checkFun!==undefined&&!checkFun(userId)){return}axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/getAllProgressBar',params:{id:userId}}).then(function(res){if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}transferDepositStatus(params,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e),checkFun=undefined){if(checkFun!==undefined&&!checkFun(params)){return}const formData=new FormData();params["secure.key"]=this.getSk();formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/transferDepositStatus',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}getSpaceMaxSize(userId,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e)){axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/getSpaceSize',params:{spaceId:userId.toString()}}).then(function(res){const data=res.data;if(isNaN(data['res'])){if(errorFun!==undefined){errorFun(data['res']+" is NAN!!!")}return}if(okFun!==undefined){okFun(data['res'])}else{console.info(data['res'])}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}getVersion(okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e)){axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/getVersion',}).then(function(res){if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}getUseSize(userId,type,okFun=undefined,errorFun=(e)=>'res'in e?alert(e['res']):alert(e)){if(userId===undefined||type==null||type===''){const err="您必须要输入 userId 和 type 参数才可以进行使用数量的获取";if(errorFun!==undefined){errorFun(err)}else{console.error(err)}return}const formData=new FormData();const params={userId:userId,type:type,"secure.key":this.getSk()};formData.append('params',JSON.stringify(params));axios.defaults.withCredentials=true;axios({method:'post',url:this.diskMirrorUrl+this.getController()+'/getUseSize',data:formData,headers:{'Content-Type':'multipart/form-data'}}).then(function(res){if(okFun!==undefined){okFun(res.data)}else{console.info(res.data)}}).catch(function(err){if(errorFun!==undefined){errorFun(err)}else{console.error(err)}})}setDiskMirrorXorSecureKey(domain){const cookieName='diskMirror_xor_secure_key';const encryptedValue=this.xorEncrypt(this.getSk());if(this.isSetCookie&&this.cookieValue===encryptedValue&&this.cookieDoMain===domain){return}if(domain){document.cookie=`${cookieName}=${encryptedValue};path=/;domain=${domain}`;return}document.cookie=`${cookieName}=${encryptedValue};path=/`;this.isSetCookie=true;this.cookieValue=encryptedValue;this.cookieDoMain=domain}}